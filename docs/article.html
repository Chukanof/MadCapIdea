<h1>Introduction</h1>
<p>This article is the culmination of stuff I have been doing on the train on my 
way to work over 6 months. I have written quite a lot of blog posts on this 
already which you can read about on the projects home page on my blog :
<a href="https://sachabarbs.wordpress.com/2017/05/01/madcap-idea/" target="_blank">
https://sachabarbs.wordpress.com/2017/05/01/madcap-idea/</a> </p>
<p>There are 13 blog posts there, but I thought it would be good to also have 
this overall article which covers all of it, as the blog posts are more a 
sequence of events that I went through which talk about the peices in great 
detail as I went through them</p>
<p>For example these were the blog posts</p>
<ul>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/05/15/madcap-idea-part-1-start-of-the-client-side-portion-of-the-web-site/" target="_blank">
	MADCAP IDEA PART 1 : START OF THE CLIENT SIDE PORTION OF THE WEB SITE</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/05/23/madcap-idea-part-2-adding-diioc-to-the-client-side-front-end-web-site/" target="_blank">
	MADCAP IDEA PART 2 : ADDING DI/IOC TO THE CLIENT SIDE FRONT END WEB SITE</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/06/07/madcap-idea-part-3-bringing-play-back-end-into-the-fold-some-basic-streaming-2/" target="_blank">
	MADCAP IDEA PART 3 : BRINGING PLAY BACK END INTO THE FOLD + SOME BASIC 
	STREAMING</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/06/07/madcap-idea-part-4-prototyping-the-screens/" target="_blank">
	MADCAP IDEA PART 4 : PROTOTYPING THE SCREENS</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/06/13/madcap-idea-part-5-adding-react-router/" target="_blank">
	MADCAP IDEA PART 5 : ADDING REACT-ROUTER</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/06/27/madcap-idea-part-6-static-screen-design/" target="_blank">
	MADCAP IDEA PART 6 : STATIC SCREEN DESIGN</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/08/01/madcap-idea-part-7-registrationlogin-backend/" target="_blank">
	MADCAP IDEA PART 7 : REGISTRATION/LOGIN BACKEND</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/09/01/madcap-idea-part-8-intermediate-step-rest-api-for-interactive-kafka-stream-ktable-queries/" target="_blank">
	MADCAP IDEA PART 8 : INTERMEDIATE STEP, REST API FOR INTERACTIVE KAFKA 
	STREAM KTABLE QUERIES</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/09/11/madcap-idea-9-kafka-streams-interactive-queries/" target="_blank">
	MADCAP IDEA 9 : KAFKA STREAMS INTERACTIVE QUERIES</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/09/21/madcap-idea-10-play-framework-reactive-kafka-producer/" target="_blank">
	MADCAP IDEA 10 : PLAY FRAMEWORK REACTIVE KAFKA PRODUCER</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/09/28/madcap-idea-11-finishing-the-view-rating-page/" target="_blank">
	MADCAP IDEA 11 : FINISHING THE ‘VIEW RATING’ PAGE</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/10/24/madcap-idea-12-getting-the-create-job-to-work-end-end/" target="_blank">
		MADCAP IDEA 12 : GETTING THE ‘CREATE JOB’ TO WORK END–END</a></li>
	<li>
	<a href="https://sachabarbs.wordpress.com/2017/11/23/madcap-idea-13-getting-the-view-job-to-work-end-end/" target="_blank">
	MADCAP IDEA 13 : GETTING THE ‘VIEW JOB’ TO WORK END-END</a></li>
</ul>
<p>&nbsp;</p>
<h2>So just exactly what is it that I was/am talking about?</h2>
<p>In essence I want to write a very (pardon the pun) but uber simple “uber” 
type app. Where there are the following funtional requirements<br><br></p>
<ul>
	<li>There should be a web interface that a client can use. Clients may be a 
	“driver” or a “pickup client” requireing a delivery</li>
	<li>There should be a web interface that a “pickup client” can use, that 
	shows a “pickup client” location on a map, which the “pickup client” choses.</li>
	<li>The “pickup client” may request a pickup job, in which case “drivers” 
	that are in the area bid for a job.</li>
	<li>The “pickup client” location should be visible to a “driver” on a map</li>
	<li>A “driver” may bid for a “pickup client” job, and the bidding 
	“driver(s)” location should be visible to the “pickup client”.</li>
	<li>The acceptance of the bidding “driver” is down to the “pickup client”</li>
	<li>Once a “pickup client” accepts a “driver” ONLY the assigned “driver(s)” 
	current map position will be shown to the “pickup client”</li>
	<li>When a “pickup client” is happy that they have been picked up by a 
	“driver”, the “pickup client” may rate the driver from 1-10, and the 
	“driver” may also rate the “pickup client” from 1-10.</li>
	<li>The rating should only be available once a “pickup client” has marked a 
	job as “completed”</li>
	<li>A “driver” or a “pickup client” should ALWAYS be able to view their 
	previous ratings. </li>
</ul>
<p>Whilst this may sound child’s play to a lot of you (me included if I 
stuck to using simply CRUD operations), I just want to point out that this 
app is meant as a learning experience so I will not be using a simple 
SignalR Hub, and a couple of database tables.</p>
<p>I have written this proj using a completely different set of technologies from the norm. Some 
of the technology choices could easily scale to hundreds of thousands of 
requests per second (Kafka has your back here)<br><br><strong>TECNHOLOGIES 
INVOLVED</strong></p>
<ul>
	<li>WebPack</li>
	<li>React Router</li>
	<li>TypeScript</li>
	<li>Babel.js</li>
	<li>Akka</li>
	<li>Scala</li>
	<li>Play (Scala Http Stack)</li>
	<li>MongoDB</li>
	<li>SBT</li>
	<li>Kafka</li>
	<li>Kafka Streams</li>
</ul>
<p>They say a picture says a 1000nd words, so here is a nice picture to get 
things started</p>
<p><img alt="" height="565" src="overviewSmall.png" width="630"></p>
<p>Now before we carry on, lety me just acknowledge that
<a href="http://www.codeproject.com">www.codeproject.com</a> is mainly a 
Microsoft set of articles, and this code is mainly scala/typescript I think 
there is still plenty to learn along the way, so dont let the fact its not 
.NET/C/C++ put you off</p>
<p>&nbsp;</p>
<h1>Where is the code?</h1>
<p>The code for all of this lot is here :
<a href="https://github.com/sachabarber/MadCapIdea" target="_blank">
https://github.com/sachabarber/MadCapIdea</a></p>
<h1>Prerequisites</h1>
<p>As shown in the introduction section, there are many moving peices to this 
demo, so there are quite naturally a few dependencies. I did try to get it to 
work in Docker for you all, however I found that I still needed to create 
external scripts to orchestrate it all anyway. In the end I just went with 
downloading stuff as I will specify, and then giving a single PowerShell script 
to run most stuff, apart from 2 Scala projects.</p>
<p>This is the list of stuff you will need in order to run this code:</p>
<p>This has all been developed on Windows, so these instructions are all about 
how to get stuff working on Windows<br><br>- MongoDB :
<a href="https://www.mongodb.com/dr/fastdl.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-3.4.6-signed.msi/download" target="_blank">
https://www.mongodb.com/dr/fastdl.mongodb.org/win32/mongodb-win32-x86_64-2008plus-ssl-3.4.6-signed.msi/download</a><br>
- Confluence Platform 3.3.0 Open Source :
<a href="http://packages.confluent.io/archive/3.3/confluent-oss-3.3.0-2.11.zip" target="_blank">
http://packages.confluent.io/archive/3.3/confluent-oss-3.3.0-2.11.zip</a><br>- 
SBT<br>- Java 8 SDK<br>- Webpack<br>- Node.Js<br>- NPM<br>- IntelliJ IDEA v17.0 
community<br>- PowerShell</p>
<p>Once you have downloaded all of this you will need to do a few things in 
order to run it nicely on Windows, so these instructions are all about how to 
get stuff working on Windows<br><br>- Download the dependencies above <span style="background-color:yellow; border:1px black solid">(Keep a 
note of where you downloaded them as you will need them here and later)</span><br>- 
Replace the official <span style="background-color:yellow; border:1px black solid">YOUR extract location</span>\confluent-3.3.0\bin\windows BAT files with the ones found 
here :
<a href="https://github.com/renukaradhya/confluentplatform/tree/master/bin/windows" target="_blank">
https://github.com/renukaradhya/confluentplatform/tree/master/bin/windows</a><br>
- Modify the <span style="background-color:yellow; border:1px black solid">YOUR extract location</span>\confluent-3.3.0\etc\kafka\zookeeper.properties file to change the 
<code>dataDir </code>to something like <code>dataDir=c:/temp/zookeeper</code><br>- Modify the 
<span style="background-color:yellow; border:1px black solid">YOUR extract location</span>\confluent-3.3.0\etc\kafka\server.properties file to uncomment the line 
<code>delete.topic.enable=true</code><br>- Modify the 
<span style="background-color:yellow; border:1px black solid">YOUR extract location</span>\confluent-3.3.0\etc\kafka\server.properties file file to change the 
<code>log.dirs</code> to <code>log.dirs=c:/temp/kafka-logs</code></p>
<p>You will need to remember some of these paths for the next section too, so 
just be mindful that you may have to edit the PowerShell script later with some 
new paths</p>
<h1>How do I run all this stuff?</h1>
<p>There are quite a few moving peices to this app, and they all need to be 
running in order for it to all work together.</p>


<strong>1. Update node.js dependencies</strong>
<p>Make sure you have Node.Js installed, and make sure NPM is installed too, also ensure that webpack is globally installed</p>
<p>Open command line and change to the <code>MadCapIdea\PlayBackEndApi\FrontEndWebSite\</code> folder and run 
<code>npm install</code></p>
<ul>
<li>now run <code>webpack </code>from same folder</li>
</ul>

<strong>2. Kafka/Zookeeper etc etc</strong>
<p>You can run the following powershell script to get all the pre-requistites up and running (assuming you have downloaded them all)
</p>
<ul>
<li>Open PowerShell command line and change to the <code>PowerShellProject\PowerShellProject\</code> folder and run 
<code>.\RunPipeline.ps1</code></li>
</ul>

<strong>3. Play application</strong>
<ul>
<li>Open the SBT/Scala project inside IntelliJ IDEA (you will need the SBT plugin, and Java8 installed on your machine).</li>
<li>Open this folder <code>MadCapIdea\PlayBackEndApi </code>and run it.You may need to create a run time configuration</li>
</ul>


<strong>4. Kafka Streams application</strong>
<ul>
<li>Open the SBT/Scala project inside IntelliJ IDEA (you will need the SBT plugin, and Java8 installed on your machine). </li>
<li>Open this folder <code>MadCapIdea\KafkaStreams</code> and run it.You may need to create a run time configuration 
where you point to this main class <code>RatingStreamProcessingApp</code></li>
</ul>

<strong>5. React</strong>
<ul>
<li>Open a browser navigate to <code>http://localhost:9000</code>, and register some users both passenger/driver</li>
</ul>



<p>I normally follow this set of steps afterwards</p>
<ul>
<li>open a tab, login as a passenger that I had created</li>
<li>go to the "create job" page, click the map, push the "create job" button</li>
<li>open a NEW tab, login as a new driver, go to the "view job" page</li>
<li>on the 1st tab (passenger) click the map to push passenger position to driver</li>
<li>on the 2nd tab (driver) click the map to push driver position to passenger</li>
<li>repeat last 4 steps for additonal driver</li>
<li>on client tab pick driver to accept, click accept button</li>
<li>complete the job from client tab, give driver rating</li>
<li>complete the job from paired driver tab, give passenger rating</li>
<li>go to "view rating" page, should see ratings</li>

</ul>








<h1>&nbsp;</h1>
<h1>Known issues</h1>
<p>The following are known issues</p>
<ul>
	<li>One a driver an passenger become paired, the position updates from 
	either are no longer reflected. I am sure this would boil down to a single 
	JavaScript method that needs updating in the ViewJob.tsx file. However I 
	just kind of got to the end of a very long road (I have been writing about 
	this on an off for 6 months of train rides) and was just happy that I got 
	99% of the stuff done, and just thought you know what, the app as it is now 
	demonstrates everything I set out to do, so I&#39;m ok with one known issue</li>
</ul>
<h1>Some basics</h1>
<p>Before we dive into the actual code for the app (and there is quite a bit of 
it), I just thought it may be good to go over some of the individual building 
blocks that make up the app as a whole first, the next few sections will do 
that.</p>
<h1>What is Kafka?</h1>
<h1>What is Kafka Streams?</h1>
<h1>What is Play</h1>
<h1>What is WebPack</h1>
<h1>What is React</h1>
<h1>The app</h1>
<h1>Registration workflow</h1>
<h1>Login workflow</h1>
<h1>CreateJob workflow</h1>
<h1>ViewJob workflow</h1>
<h1>ViewRating workflow</h1>
<h1>Conclusion</h1>
<p>This was certainly a challenging thing to write, and I am honestly pleased that I got it done, I have had a really good time writing this. And it has been a great project for self improvement, and 
I would recommend this type of thing as a great use of time. Go on find yourself 
a pet project</p>



